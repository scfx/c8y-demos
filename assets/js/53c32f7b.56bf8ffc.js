"use strict";(self.webpackChunkc_8_y_docs=self.webpackChunkc_8_y_docs||[]).push([[9654],{9854:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>a});var t=i(4848),r=i(8453);const s={sidebar_position:3},d="Node-Red",o={id:"thin-edge/node-red",title:"Node-Red",description:"Pre-requisites",source:"@site/docs/thin-edge/node-red.md",sourceDirName:"thin-edge",slug:"/thin-edge/node-red",permalink:"/c8y-demos/docs/thin-edge/node-red",draft:!1,unlisted:!1,editUrl:"https://github.com/scfx/c8y-demos/docs/thin-edge/node-red.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Container management",permalink:"/c8y-demos/docs/thin-edge/container-management"},next:{title:"Local UI",permalink:"/c8y-demos/docs/thin-edge/local-ui"}},l={},a=[{value:"Pre-requisites",id:"pre-requisites",level:2},{value:"Plugin summary",id:"plugin-summary",level:2},{value:"How to do I get it?",id:"how-to-do-i-get-it",level:3},{value:"What will be deployed to the device?",id:"what-will-be-deployed-to-the-device",level:3},{value:"Activating a project",id:"activating-a-project",level:3},{value:"Plugin Dependencies",id:"plugin-dependencies",level:2},{value:"Known issues",id:"known-issues",level:2},{value:"Development",id:"development",level:2},{value:"Start demo",id:"start-demo",level:3},{value:"Stop demo",id:"stop-demo",level:3},{value:"Design",id:"design",level:2},{value:"Proposed workflow of a node-red project",id:"proposed-workflow-of-a-node-red-project",level:3},{value:"Package format",id:"package-format",level:3},{value:"Option1: Configuration file containing the URL of the project",id:"option1-configuration-file-containing-the-url-of-the-project",level:4},{value:"Option 2: Single tarball (tar.gz) file containing a snapshot of the project",id:"option-2-single-tarball-targz-file-containing-a-snapshot-of-the-project",level:4},{value:"Packaging a node-red project",id:"packaging-a-node-red-project",level:3},{value:"Archive the full directory",id:"archive-the-full-directory",level:4},{value:"Archive current branch",id:"archive-current-branch",level:4},{value:"Uploading a project using an external URL",id:"uploading-a-project-using-an-external-url",level:3},{value:"Future ideas",id:"future-ideas",level:2}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"node-red",children:"Node-Red"}),"\n",(0,t.jsx)(n.h2,{id:"pre-requisites",children:"Pre-requisites"}),"\n",(0,t.jsxs)(n.p,{children:["You need to have node-red already installed on your device. If you don't already have it then check out the ",(0,t.jsx)(n.a,{href:"https://nodered.org/docs/getting-started/",children:"Node-RED documentation"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"plugin-summary",children:"Plugin summary"}),"\n",(0,t.jsx)(n.p,{children:"Install/remove node-red projects on a device using thin-edge.io software management plugin."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Technical summary"})}),"\n",(0,t.jsx)(n.p,{children:"The following details the technical aspects of the plugin to get an idea what systems it supports."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{}),(0,t.jsx)(n.th,{})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Languages"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"shell"})," (posix compatible)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"CPU Architectures"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"all/noarch"}),". Not CPU specific"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Supported init systems"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"N/A"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Required Dependencies"})}),(0,t.jsx)(n.td,{children:"-"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Optional Dependencies (feature specific)"})}),(0,t.jsx)(n.td,{children:"-"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"how-to-do-i-get-it",children:"How to do I get it?"}),"\n",(0,t.jsxs)(n.p,{children:["The following linux package formats are provided on the releases page and also in the ",(0,t.jsx)(n.a,{href:"https://cloudsmith.io/~thinedge/repos/community/packages/",children:"tedge-community"})," repository:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Operating System"}),(0,t.jsx)(n.th,{children:"Repository link"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Debian/Raspian (deb)"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://cloudsmith.io/~thinedge/repos/community/packages/detail/deb/tedge-nodered-plugin/latest/a=all;d=any-distro%252Fany-version;t=binary/",children:(0,t.jsx)(n.img,{src:"https://api-prd.cloudsmith.io/v1/badges/version/thinedge/community/deb/tedge-nodered-plugin/latest/a=all;d=any-distro%252Fany-version;t=binary/?render=true&show_latest=true",alt:"Latest version of 'tedge-nodered-plugin' @ Cloudsmith"})})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Alpine Linux (apk)"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://cloudsmith.io/~thinedge/repos/community/packages/detail/alpine/tedge-nodered-plugin/latest/a=noarch;d=alpine%252Fany-version/",children:(0,t.jsx)(n.img,{src:"https://api-prd.cloudsmith.io/v1/badges/version/thinedge/community/alpine/tedge-nodered-plugin/latest/a=noarch;d=alpine%252Fany-version/?render=true&show_latest=true",alt:"Latest version of 'tedge-nodered-plugin' @ Cloudsmith"})})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"RHEL/CentOS/Fedora (rpm)"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://cloudsmith.io/~thinedge/repos/community/packages/detail/rpm/tedge-nodered-plugin/latest/a=noarch;d=any-distro%252Fany-version;t=binary/",children:(0,t.jsx)(n.img,{src:"https://api-prd.cloudsmith.io/v1/badges/version/thinedge/community/rpm/tedge-nodered-plugin/latest/a=noarch;d=any-distro%252Fany-version;t=binary/?render=true&show_latest=true",alt:"Latest version of 'tedge-nodered-plugin' @ Cloudsmith"})})})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"what-will-be-deployed-to-the-device",children:"What will be deployed to the device?"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The following software management plugins which is called when installing and removing ",(0,t.jsx)(n.code,{children:"nodered"})," projects via Cumulocity IoT","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nodered"})," - Deploy a project using the node-red project structure (e.g. git repository containing a flow)"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"activating-a-project",children:"Activating a project"}),"\n",(0,t.jsxs)(n.p,{children:["Node-red supports deploying multiple projects to a device however only one project can be active at one time. The ",(0,t.jsx)(n.code,{children:"tedge-nodered-plugin"})," supports installing multiple projects, and the active project can be controlled by a special (magic) package name"]}),"\n",(0,t.jsx)(n.p,{children:"A project can be activated by using a special package name and version."}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Name"}),(0,t.jsx)(n.th,{children:"Version"}),(0,t.jsx)(n.th,{children:"SoftwareType"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"active-project"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"<project_name>"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"nodered"})})]})})]}),"\n",(0,t.jsx)(n.p,{children:"The reasoning behind having the magic package was to allow users to deploy projects to devices and decide whether it should be activated or not. Sometimes not automatically activating a project can be useful if you want to download the project to all the devices but wait to activate it at a later point in time."}),"\n",(0,t.jsx)(n.h2,{id:"plugin-dependencies",children:"Plugin Dependencies"}),"\n",(0,t.jsx)(n.p,{children:"The following packages are required to use the plugin:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"jq"}),"\n",(0,t.jsx)(n.li,{children:"curl"}),"\n",(0,t.jsx)(n.li,{children:"node-red"}),"\n",(0,t.jsx)(n.li,{children:"npm (requirement of node-red)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"known-issues",children:"Known issues"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Activating a new project for the first time does not seem to work for reasons unknown, however restarting the ",(0,t.jsx)(n.code,{children:"nodered"})," service seems to fix this. The root cause should be investigated as it is probably a sign that an API call is missing or the install sequence is wrong."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"development",children:"Development"}),"\n",(0,t.jsx)(n.h3,{id:"start-demo",children:"Start demo"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Start the demo"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"just up\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Open the exposed container port ",(0,t.jsx)(n.a,{href:"http://localhost:1880",children:"http://localhost:1880"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"stop-demo",children:"Stop demo"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"just down\n"})}),"\n",(0,t.jsx)(n.h2,{id:"design",children:"Design"}),"\n",(0,t.jsx)(n.h3,{id:"proposed-workflow-of-a-node-red-project",children:"Proposed workflow of a node-red project"}),"\n",(0,t.jsx)(n.p,{children:"The following workflow details how node-red projects could be deployed to a fleet of devices. It shows the development process through to the deployment to devices."}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create git repo for a node-red project (containing a flow)"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Build/test the flow using a github runner or run on a device"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Publish the flow to Cumulocity using go-c8y-cli to the software package (with new version)"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Manually create a bulk operation to deploy the new flow to the fleet of devices"}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"package-format",children:"Package format"}),"\n",(0,t.jsx)(n.h4,{id:"option1-configuration-file-containing-the-url-of-the-project",children:"Option1: Configuration file containing the URL of the project"}),"\n",(0,t.jsx)(n.p,{children:"A single file containing the git URL which can be used to clone the project on the device."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"REPO=https://github.com/reubenmiller/nodered-demo.git\n"})}),"\n",(0,t.jsx)(n.h4,{id:"option-2-single-tarball-targz-file-containing-a-snapshot-of-the-project",children:"Option 2: Single tarball (tar.gz) file containing a snapshot of the project"}),"\n",(0,t.jsx)(n.p,{children:"The single tarball which contains the exported project's files."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"flow.json"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"settings.js (used to parameterize the flow.json)"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"dependencies.txt (text file containing each dependency one per line) this will be used to install npm modules"}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"version file containing the version of the snapshot on the first line"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"1.0.0\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"packaging-a-node-red-project",children:"Packaging a node-red project"}),"\n",(0,t.jsxs)(n.p,{children:["Instructions how to create an offline installable node-red project. It will export a git project and create a tarball (",(0,t.jsx)(n.code,{children:".tar.gz"}),") that can be used with this plugin."]}),"\n",(0,t.jsx)(n.h4,{id:"archive-the-full-directory",children:"Archive the full directory"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'COMMIT=$(git rev-parse --short HEAD);\nBRANCH=$(git rev-parse --abbrev-ref HEAD);\nVERSION="$BRANCH@$COMMIT";\nARCHIVE="$(basename $(pwd))__$VERSION".tar.gz;\ntar cvzf "$ARCHIVE" .\n'})}),"\n",(0,t.jsx)(n.h4,{id:"archive-current-branch",children:"Archive current branch"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create an archive using git (requires a recent version of git which supports the --add-virtual-file flag)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'cd my-project\nCOMMIT=$(git rev-parse --short HEAD);\nBRANCH=$(git rev-parse --abbrev-ref HEAD);\nVERSION="$BRANCH@$COMMIT";\nARCHIVE="$(basename $(pwd))__$VERSION".tar.gz;\ngit archive --format=tar.gz --add-virtual-file=version:"$VERSION" -o "$ARCHIVE" HEAD;\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create the software item and upload the version to the Cumulocity software repository"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'c8y software create --name nodered-demo --description "Node red flow" --data softwareType=nodered\n'})}),"\n",(0,t.jsx)(n.p,{children:"Then add the version"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'c8y software versions create --software nodered-demo --version "$VERSION::nodered" --file ./nodered-demo__master@32256bb.tar.gz\n\n# Or using wildcards\nc8y software versions create --software nodered-demo --version "$VERSION::nodered" --file ./nodered-demo__*@*.tar.gz\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create an active flow software entry to control which item should be active. There should be one per flow"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'c8y software create --name active-flow --description "Active node-red flow" --data softwareType=nodered\nc8y software versions create --software active-flow --version "nodered-demo::nodered" --url " "\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"uploading-a-project-using-an-external-url",children:"Uploading a project using an external URL"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create a configuration file containing the url"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"REPO=https://github.com/reubenmiller/nodered-demo\n"})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:"Create a software version item in Cumulocity IoT"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:'c8y software versions create --software nodered-demo --version "latest::nodered" --file ./tests/testdata/nodered-demo.cfg\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"future-ideas",children:"Future ideas"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"How to spawn to node-red instances to support applying multiple flows on the same device. Each instance must use a different port / service."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>o});var t=i(6540);const r={},s=t.createContext(r);function d(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);